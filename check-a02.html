<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>API Viewer ‚Äî UX Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.9.96/css/materialdesignicons.min.css" rel="stylesheet">
<script src="https://unpkg.com/mermaid@10.4.0/dist/mermaid.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>
<style>
:root{
  --bg:#f6f8ff; --card:#fff; --accent:#4f46e5; --muted:#6b7280; --success:#16a34a; --danger:#ef4444;
  --glass: rgba(79,70,229,0.06);
  --maxw:1200px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,var(--bg),#fbfdff);-webkit-font-smoothing:antialiased}
.container{max-width:var(--maxw);margin:28px auto;padding:20px;border-radius:14px;background:var(--card);box-shadow:0 18px 46px rgba(12,16,40,0.08);display:grid;grid-template-columns:420px 1fr;gap:18px;align-items:start}
.header{grid-column:1/-1;display:flex;gap:14px;align-items:center;margin-bottom:2px}
.logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#7c3aed);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:18px;box-shadow:0 10px 28px rgba(79,70,229,0.16)}
.title h1{margin:0;font-size:1.15rem;color:#071033}
.title p{margin:2px 0 0;color:var(--muted);font-size:0.92rem}

/* left panel */
.panel{padding:14px;border-radius:12px;background:linear-gradient(180deg,#fff,#fbfdff);border:1px solid rgba(12,16,40,0.03)}
label{display:block;font-weight:600;margin-bottom:6px;color:#071033;font-size:0.88rem}
.input,select{width:100%;padding:10px 12px;border-radius:10px;border:1.5px solid #e6e9f2;background:#fff;font-size:0.95rem}
.row{display:flex;gap:10px}
.small{font-size:0.86rem;color:var(--muted)}
.actions{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
.btn{border:0;border-radius:10px;padding:10px 12px;font-weight:700;cursor:pointer;background:#f3f4f6;color:#071033;display:inline-flex;gap:8px;align-items:center}
.btn.primary{background:var(--accent);color:#fff;box-shadow:0 8px 22px rgba(79,70,229,0.12)}
.tag{background:var(--glass);padding:6px 10px;border-radius:999px;color:#0b1220;font-size:0.86rem}
.list{margin-top:10px;max-height:200px;overflow:auto;border-radius:8px;padding:8px;background:linear-gradient(180deg,#fff,#fbfdff);border:1px dashed rgba(79,70,229,0.04)}
.list button{display:block;width:100%;text-align:left;padding:8px;border-radius:8px;background:transparent;border:none;font-size:0.92rem}

/* right panel */
.output{display:flex;flex-direction:column;gap:10px}
.toolbar{display:flex;align-items:center;justify-content:space-between;gap:12px}
.meta{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.pill{padding:6px 10px;border-radius:999px;background:#f3f4f6;font-weight:700}
.controls{display:flex;gap:8px;align-items:center}
.result{background:#0b1220;color:#e6eef8;border-radius:10px;padding:14px;font-family:ui-monospace,SFMono-Regular,Menlo,monospace;font-size:0.95rem;min-height:320px;overflow:auto;white-space:pre-wrap}
.err{color:var(--danger);background:#fff5f5;border:1px solid rgba(239,68,68,0.08);padding:8px;border-radius:8px;font-weight:600}
.grid-wide{display:grid;grid-template-columns:1fr 360px;gap:12px;margin-top:8px}

/* visuals */
.diagram{background:#fff;padding:10px;border-radius:8px;border:1px solid rgba(12,16,40,0.03)}
.chartBox{height:220px;border-radius:8px;background:#fff;padding:8px;border:1px solid rgba(12,16,40,0.03)}

/* responsive */
@media (max-width:980px){.container{grid-template-columns:1fr;padding:12px}.logo{width:48px;height:48px}}
kbd{background:#111827;color:#fff;padding:4px 6px;border-radius:6px;font-size:0.82rem}
.footer{grid-column:1/-1;display:flex;justify-content:space-between;color:var(--muted);font-size:0.88rem;padding-top:6px}
</style>
</head>
<body>
<div class="container" role="main" aria-label="API Viewer UX Pro">
  <div class="header">
    <div class="logo" aria-hidden="true">API</div>
    <div class="title">
      <h1>API Viewer ‚Äî UX Pro ‚ú®</h1>
      <p class="small">‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‚Äî presets, history, pretty/raw, Mermaid ‡πÅ‡∏•‡∏∞ chart ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
    </div>
  </div>

  <!-- LEFT -->
  <aside class="panel" aria-labelledby="reqTitle">
    <h2 id="reqTitle" style="margin:0 0 8px">Request üîé</h2>
    <form id="form" autocomplete="off">
      <label for="url">Endpoint URL</label>
      <input id="url" class="input" placeholder="http://host:port/player_api.php?username=xxx&password=yyy" required>

      <div style="margin-top:10px" class="row">
        <div style="flex:1">
          <label for="action">Action</label>
          <select id="action" class="input">
            <option value="">(auto) get_info</option>
            <option>get_info</option>
            <option>get_simple_info</option>
            <option>get_live_streams</option>
          </select>
        </div>
        <div style="width:120px">
          <label style="visibility:hidden">submit</label>
          <button id="fetchBtn" class="btn primary" type="submit"><span class="mdi mdi-rocket-launch"></span> Go</button>
        </div>
      </div>

      <div class="actions" style="margin-top:12px">
        <button id="copyUrl" type="button" class="btn"><span class="mdi mdi-content-copy"></span> Copy URL</button>
        <button id="savePreset" type="button" class="btn"><span class="mdi mdi-bookmark-plus"></span> Save Preset</button>
        <button id="toggleProxy" type="button" class="btn"><span class="mdi mdi-web"></span> Proxy</button>
        <button id="clearForm" type="button" class="btn"><span class="mdi mdi-broom"></span> Clear</button>
      </div>

    </form>

    <div style="margin-top:14px">
      <label>Presets ‚Ä¢ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</label>
      <div id="presets" class="list" role="listbox"></div>
    </div>

    <div style="margin-top:12px">
      <label>History (local)</label>
      <div id="history" class="list"></div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="clearHistory" class="btn"><span class="mdi mdi-delete"></span> Clear</button>
        <button id="resetPresets" class="btn"><span class="mdi mdi-restore"></span> Reset</button>
      </div>
    </div>

    <div style="margin-top:12px" class="small">Tip: ‡∏Å‡∏î <kbd>Ctrl/Cmd + Enter</kbd> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡πÄ‡∏£‡πá‡∏ß ‚ö°</div>
  </aside>

  <!-- RIGHT -->
  <section class="panel output" aria-labelledby="outTitle">
    <h2 id="outTitle" style="margin:0 0 8px">Response üßæ</h2>
    <div class="toolbar">
      <div class="meta">
        <div id="state" class="pill">Ready</div>
        <div id="httpInfo" class="small" aria-live="polite"></div>
      </div>
      <div class="controls">
        <button id="prettyBtn" class="btn"><span class="mdi mdi-format-color-text"></span> Pretty</button>
        <button id="rawBtn" class="btn"><span class="mdi mdi-console"></span> Raw</button>
        <button id="copyRes" class="btn"><span class="mdi mdi-content-copy"></span> Copy</button>
        <button id="downloadRes" class="btn"><span class="mdi mdi-download"></span> Download</button>
      </div>
    </div>

    <div id="error" class="err" style="display:none"></div>
    <pre id="result" class="result" tabindex="0" aria-live="polite">-- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà --</pre>

    <div class="grid-wide">
      <div class="diagram">
        <div class="small" style="margin-bottom:6px">Flowchart</div>
        <div class="mermaid" id="flow">
flowchart LR
  U[User enters URL] --> V{Validate URL}
  V -->|OK| F[Build request]
  V -->|Missing creds| E[Show error]
  F --> P[Fetch (proxy optional)]
  P --> R[Parse response]
  R --> D[Render & Chart]
        </div>
      </div>

      <div>
        <div class="small" style="margin-bottom:6px">Response Insight üìä</div>
        <div id="chart" class="chartBox"></div>
      </div>
    </div>

    <div style="margin-top:8px" class="small">Status: <span id="lastAction">‚Äî</span></div>
  </section>

  <div class="footer">
    <div>Made with ‚ù§Ô∏è ‚Äî UX Pro ‚Ä¢ Icons: mdi ‚Ä¢ Diagram: Mermaid ‚Ä¢ Charts: ECharts</div>
    <div class="small">Width capped at 1200px</div>
  </div>
</div>

<script>
mermaid.initialize({startOnLoad:true, theme:'base', securityLevel:'loose'});
const $ = id => document.getElementById(id);
const url = $('url'), action = $('action'), presetsBox = $('presets'), historyBox = $('history');
const result = $('result'), errorBox = $('error'), state = $('state'), httpInfo = $('httpInfo'), lastAction = $('lastAction');
let useProxy = true, lastJson = null, pretty = true;
const PROXY = 'https://cors-anywhere.herokuapp.com/';

const DEFAULTS = [
  {n:'get_info (example) üßæ', u:'http://example.local/player_api.php?username=user&password=pass&action=get_info'},
  {n:'get_simple_info', u:'http://example.local/player_api.php?username=user&password=pass&action=get_simple_info'},
  {n:'get_live_streams', u:'http://example.local/player_api.php?username=user&password=pass&action=get_live_streams'}
];

function ls(k,v){ if(v===undefined) return JSON.parse(localStorage.getItem(k)||'null'); localStorage.setItem(k,JSON.stringify(v)); }
function loadPresets(){ return ls('presets')||DEFAULTS; }
function savePresets(a){ ls('presets',a); renderPresets(); }
function renderPresets(){ const a=loadPresets(); presetsBox.innerHTML=''; a.forEach(p=>{const b=document.createElement('button');b.textContent=p.n;b.title=p.u;b.onclick=()=>url.value=p.u;presetsBox.appendChild(b);}); }
function loadHistory(){ return ls('history')||[]; }
function saveHistory(u){ if(!u) return; let h=loadHistory(); h=h.filter(x=>x.u!==u); h.unshift({u,t:Date.now()}); h=h.slice(0,12); ls('history',h); renderHistory(); }
function renderHistory(){ const h=loadHistory(); historyBox.innerHTML=''; if(!h.length){ historyBox.innerHTML='<div class="small">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>'; return;} h.forEach(it=>{const b=document.createElement('button'); b.innerHTML=`<strong style="font-size:0.92rem">${it.u}</strong><div style="font-size:0.82rem;color:var(--muted)">${new Date(it.t).toLocaleString()}</div>`; b.onclick=()=>url.value=it.u; historyBox.appendChild(b); }); }
renderPresets(); renderHistory();

function setState(t,loading=false){ state.textContent=t; if(loading) state.innerHTML = t + ' ‚è≥'; }
function showError(txt){ errorBox.style.display='block'; errorBox.textContent=txt; setState('Error'); }
function clearError(){ errorBox.style.display='none'; errorBox.textContent=''; setState('Ready'); }

function buildTarget(raw){
  try{
    const u = new URL(raw);
    if(!u.searchParams.get('action') && action.value) u.searchParams.set('action', action.value);
    else if(!u.searchParams.get('action')) u.searchParams.set('action','get_info');
    return useProxy ? PROXY + u.toString() : u.toString();
  }catch(e){ return null; }
}

function renderResult(data, code){
  lastJson = data;
  httpInfo.textContent = code ? 'HTTP '+code : '';
  clearError();
  result.textContent = pretty ? JSON.stringify(data,null,2) : JSON.stringify(data);
  updateChart(data);
  lastAction.textContent = new Date().toLocaleString();
}

function updateChart(data){
  try{
    const dom = document.getElementById('chart');
    if(!dom._ech) dom._ech = echarts.init(dom);
    const ec = dom._ech;
    let labels = [], values = [];
    if(Array.isArray(data?.videos)){
      labels = data.videos.slice(0,8).map((v,i)=>v.name||'v'+i); values = data.videos.slice(0,8).map(()=>1);
    } else if(data && typeof data === 'object'){
      const keys = Object.keys(data).slice(0,8);
      labels = keys; values = keys.map(k=>{ const v=data[k]; return typeof v === 'number' ? v : (Array.isArray(v)? v.length : 1); });
    } else { labels=['No data']; values=[0]; }
    ec.setOption({xAxis:{type:'category',data:labels},yAxis:{type:'value'},series:[{type:'bar',data:values,color: ['#7c3aed']}],tooltip:{}} , {notMerge:true});
  }catch(e){ console.warn(e); }
}

/* form handling */
$('form').addEventListener('submit', async e=>{
  e.preventDefault(); clearError();
  const raw = url.value.trim(); if(!raw){ showError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å URL'); return; }
  const target = buildTarget(raw); if(!target){ showError('URL ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); return; }
  try{ const u = new URL(raw); if(!u.searchParams.get('username') || !u.searchParams.get('password')){ showError('URL ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ username ‡πÅ‡∏•‡∏∞ password'); return; } }catch(e){ showError('URL ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); return; }
  setState('Loading', true); result.textContent='Loading...'; saveHistory(raw);
  try{
    const res = await fetch(target, {headers:{'X-Requested-With':'XMLHttpRequest'}});
    setState('Processing');
    if(!res.ok) throw new Error('HTTP '+res.status);
    const ct = res.headers.get('content-type')||'';
    if(ct.includes('application/json')){ const j = await res.json(); renderResult(j, res.status); }
    else { const txt = await res.text(); result.textContent = txt; httpInfo.textContent = 'HTTP '+res.status; lastAction.textContent = new Date().toLocaleString(); }
  }catch(err){ showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: '+err.message); result.textContent=''; }
  setTimeout(()=>setState('Ready'), 300);
});

/* controls */
$('copyUrl').addEventListener('click',()=>{ const t=buildTarget(url.value.trim()); if(!t) return showError('‡πÑ‡∏°‡πà‡∏°‡∏µ URL'); navigator.clipboard.writeText(t).then(()=>setState('URL copied')).catch(()=>showError('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à')); });
$('toggleProxy').addEventListener('click',()=>{ useProxy = !useProxy; setState(useProxy? 'Proxy ON':'Proxy OFF'); });
$('savePreset').addEventListener('click',()=>{ const v=url.value.trim(); if(!v) return showError('‡πÑ‡∏°‡πà‡∏°‡∏µ URL ‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'); const name = prompt('‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ preset:') || v; const p = loadPresets(); p.unshift({n:name,u:v}); savePresets(p.slice(0,20)); setState('Preset saved'); });
$('clearForm').addEventListener('click',()=>{ url.value=''; result.textContent='-- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà --'; clearError(); url.focus(); });
$('clearHistory').addEventListener('click',()=>{ if(confirm('‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')){ localStorage.removeItem('history'); renderHistory(); setState('History cleared'); }});
$('resetPresets').addEventListener('click',()=>{ if(confirm('‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ presets ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô?')){ localStorage.removeItem('presets'); renderPresets(); setState('Presets reset'); }});
$('copyRes').addEventListener('click',()=>{ if(!result.textContent) return; navigator.clipboard.writeText(result.textContent).then(()=>setState('Copied')).catch(()=>showError('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à')); });
$('downloadRes').addEventListener('click',()=>{ if(!result.textContent) return; const b=new Blob([result.textContent],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download='response.json'; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(a.href),1500); });
$('prettyBtn').addEventListener('click',()=>{ pretty=true; if(lastJson) result.textContent=JSON.stringify(lastJson,null,2); setState('Pretty'); });
$('rawBtn').addEventListener('click',()=>{ pretty=false; if(lastJson) result.textContent=JSON.stringify(lastJson); setState('Raw'); });

/* keyboard */
url.addEventListener('keydown', e=>{ if((e.ctrlKey||e.metaKey) && e.key==='Enter') $('fetchBtn').click(); });

/* init */
setState('Ready');
try{ setTimeout(()=>mermaid.init(undefined, document.querySelectorAll('.mermaid')),200); }catch(e){}
</script>
</body>
</html>
